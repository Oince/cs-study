# 프로세스 계층 구조란?

네트워크던 운영체제던, 컴퓨터와 관련된 공부를 하다 보면 계층 구조가 심심치 않게 나타난다.
심심치 않은 그 시점이 또 찾아왔다. 프로세스 계층 구조이다.

운영체제에서 프로세스는 단일 개체로 독립적으로 실행된다.
하지만, 내부적으로는 부모-자식 관계를 형성하여 트리 형태의 계층 구조를 이룬다.

그 이유는, 프로세스는 실행 도중 시스템 콜을 통해 다른 프로세스를 생성할 수 있기 때문이다.

## 부모 프로세스와 자식 프로세스

프로세스는 실행 도중 시스템 콜을 통해 다른 프로세스를 생성할 수 있다.

이때, 새 프로세스를 생성한 프로세스를 부모 프로세스, 부모 프로세스에 의해 생성된 프로세스를 자식 프로세스라 한다.

- 부모와 자식을 엄연히 다른 프로세스이기에, 서로 다른 PID를 가짐
- 일부 운영체제에서는 자식 프로세스의 PCB에 부모 프로세스의 PID인 PPID(Parent PID)가 기록되기도 함

## 프로세스 계층 구조

<img width="1584" height="683" alt="image" src="https://github.com/user-attachments/assets/aaa2139b-e6b7-4160-bad9-96d594a72173" />

이런 형식으로, 최초의 프로세스부터 시작하여,

최초의 프로세스가 생성한 자식 프로세스들이 또 새로운 자식 프로세스들을 생성하는 형식으로 가다 보면 이와 같이 계층 구조가 생성된다.

## 최초의 프로세스 (Process 1)

OS가 생성하여, 모든 프로세스 최상단에 있는 부모 프로세스이다.

항상 PID가 1번이고, 운영체제 별로 이름은 조금 다르다.
Unix는 init, Linux는 systemd, MacOS는 launched라고 한다.

모든 프로세스는 최초 프로세스(systemd, init 등)를 기점으로 계층적으로 연결된다.

그런데 왜 윈도우의 최초 프로세스는 알려주지 않는 것일까? 내가 윈도우 사용자기에 호기심이 생겨 그것을 한 번 살펴보기로 했다. (아래에 있음)

그건 그렇다치고, 살펴보면 PID가 0인 친구 (idle process)가 존재한다. 얜 뭘까?

### Process 0 (Idle Process)

컴퓨터를 부팅하면, ROM에 있는 BIOS가 실행되어 하드웨어를 초기화하고, 부팅 디바이스를 선택 해 부트로더를 실행하기 위한 초기 설정을 수행한다.

그리고, 부트로더를 메인 메모리에 적재하고 실행시킨다. 부트로더는 하드 디스크 내에서 OS를 찾아 커널로 적재시킨다. 그리고 OS는 최초의 프로세스인 idle process(or swapper process)를 생성한다.

이것이 바로 최초의 프로세스, Idle process이다.
이 친구는 fork-exec를 통해 생성하지 않고, 커널이 직접 idle process를 생성하여 메인 메모리에 적재한다.

이러한 idle process는 CPU가 수행할 작업이 없을 때 실행되는 프로세스 또는 스레드로, CPU 유휴 상태를 나타내는 것이다. 이 친구가 높다고 하면, CPU가 꽤나 잘 쉬고 있는 상태라는 것을 알 수 있다.

# 프로세스 생성

부모 프로세스가 자식 프로세스를 생성하는 것을 프로세스 생성이라고 한다.
요 부분은 fork와 exec 개념은 알아야 할 것 같아 다루게 되었다.
이렇게 생성된 프로세스는 트리 구조를 형성하고 각자 고유한 번호인 PID를 가지게 된다고 위에서 언급했다.

그렇다면 프로세스의 생성은 어떻게 되는 것일까?
프로세스의 생성은 두 단계로 나뉜다.

1. 부모 프로세스는 fork()를 통해 자신의 복사본을 자식 프로세스로 생성한다. **(fork())**
2. 두 프로세스(부모/자식) 중 한 프로세스가 exec() 시스템 콜을 통해 자신의 메모리 공간을 새로운 프로그램으로 교체한다. **(exec())**
    - exec()를 호출하면
        
        프로세스의 주소 공간을 새 프로그램으로 덮어 쓰는 것이다.
        이진 파일을 메모리로 적재하고, 이 때 exec() 시스템 콜을 비롯한 원래 프로그램의 메모리 이미지를 파괴한다.
        
        그 이후 덮어 쓴 새로운 프로그램의 실행을 시작한다.
        

그런데 프로세스는 모두 자원을 필요로 한다.
자식이 자원을 받는 방법은 무엇이 있을까? 운영체제로부터 받거나, 부모와 공유하는 방법이 있다.
이에 대한 모델은 세 가지가 존재한다.

- 부모와 자식이 모든 자원을 공유하는 모델
- 자원의 일부를 공유하는 모델
- 전혀 공유하지 않는 모델 (가장 일반적)

# 참고자료

[Operating System Concepts 에센셜 - 2판, Abraham Silberschatz, Peter Baer Galvin, Greg Gagne]

[혼자 공부하는 컴퓨터 구조 + 운영체제, 강민철]

https://myungsun-e.tistory.com/20#%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4%20%EA%B3%84%EC%B8%B5%20%EA%B5%AC%EC%A1%B0%20(Process%20Hierarchy)-1

https://brorica.tistory.com/146

https://mastell.tistory.com/13

https://news.hada.io/topic?id=15239

https://rebugs.tistory.com/770

https://moil-develop.tistory.com/161

https://velog.io/@sunaookamisiroko/4.-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4-%EC%83%9D%EC%84%B1
